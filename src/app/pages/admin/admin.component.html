<div class="admin-container">
    <header class="admin-header">
        <h1>Event Management</h1>
        <div class="header-actions">
            <button class="btn btn-primary" (click)="openAddEventForm()">+ Add New Event</button>
            <button class="btn btn-secondary" (click)="logout()">Logout</button>
        </div>
    </header>

    <div class="stats-grid">
        <div class="stat-card" (click)="openStatModal('total')">
            <div class="stat-icon">üìÖ</div>
            <div class="stat-info">
                <h3>{{ stats().total }}</h3>
                <p>Total Events</p>
            </div>
        </div>
        <div class="stat-card" (click)="openStatModal('month')">
            <div class="stat-icon">üóìÔ∏è</div>
            <div class="stat-info">
                <h3>{{ stats().thisMonth }}</h3>
                <p>This Month</p>
            </div>
        </div>
        <div class="stat-card" (click)="openStatModal('upcoming')">
            <div class="stat-icon">üöÄ</div>
            <div class="stat-info">
                <h3>{{ stats().upcoming }}</h3>
                <p>Upcoming</p>
            </div>
        </div>
    </div>

    <div class="admin-layout">
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- All Events Section -->
            <div class="upcoming-section">
                <div class="section-header">
                    <h2>All Events</h2>
                    <button class="icon-btn" (click)="openSearch()" title="Search Events">
                        üîç
                    </button>
                </div>
                <div class="upcoming-list events-list">
                    <div class="upcoming-item" *ngFor="let event of allEventsList()" (click)="viewEvent(event)">
                        <div class="date-badge">
                            <span class="day">{{ event.date | date:'dd' }}</span>
                            <span class="month">{{ event.date | date:'MMM' }}</span>
                        </div>
                        <div class="event-details">
                            <h4>{{ event.title }}</h4>
                            <p>{{ event.time }} ‚Ä¢ {{ event.location }}</p>
                            <span class="event-type-pill" [class]="event.type">{{ event.type | titlecase }}</span>
                            <button class="btn btn-manage"
                                style="font-size: 0.8rem; padding: 0.3rem 0.8rem; margin-top: 0.5rem;"
                                (click)="$event.stopPropagation(); navigateToManage(event.id)">Manage Event</button>
                        </div>
                        <div class="completion-badge" *ngIf="event.completionPercentage !== undefined">
                            {{ event.completionPercentage }}%
                        </div>
                        <div class="arrow">‚Üí</div>
                    </div>
                    <div class="no-events" *ngIf="allEventsList().length === 0">
                        <p>No events found.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar (Right) - Compact Calendar -->
        <div class="sidebar">
            <div class="calendar-wrapper compact">
                <div class="calendar-header">
                    <button class="nav-btn btn-primary-style" (click)="prevMonth()">‚Üê</button>
                    <div class="header-title">
                        <select (change)="onMonthChange($event)">
                            <option *ngFor="let m of months; let i = index" [value]="i"
                                [selected]="i === currentDate().getMonth()">{{ m }}</option>
                        </select>
                        <select (change)="onYearChange($event)">
                            <option *ngFor="let y of availableYears()" [value]="y"
                                [selected]="y === currentDate().getFullYear()">{{ y }}</option>
                        </select>
                    </div>
                    <button class="nav-btn btn-primary-style" (click)="nextMonth()">‚Üí</button>
                </div>

                <div class="calendar-grid">
                    <!-- Weekday Headers -->
                    <div class="weekday">S</div>
                    <div class="weekday">M</div>
                    <div class="weekday">T</div>
                    <div class="weekday">W</div>
                    <div class="weekday">T</div>
                    <div class="weekday">F</div>
                    <div class="weekday">S</div>

                    <!-- Days -->
                    <div class="day-cell" *ngFor="let day of calendarDays()" [class.empty]="!day.isCurrentMonth"
                        (click)="onDateClick(day)">
                        <span class="day-number" *ngIf="day.dayNum > 0">{{ day.dayNum }}</span>

                        <!-- Event Dots -->
                        <div class="events-dots" *ngIf="day.events.length > 0">
                            <div class="dot" *ngFor="let event of day.events" [class]="event.type || 'other'"
                                [title]="event.title"></div>
                        </div>
                    </div>
                </div>

                <button class="btn-add-event" (click)="openAddEventForm()">+ Add New Event</button>
            </div>
        </div>
    </div>

    <!-- Day Events List Modal -->
    <div class="modal-overlay" *ngIf="selectedDayEvents()" (click)="closeDayEventsModal()">
        <div class="modal-content day-events-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>{{ selectedDayEvents()?.date | date:'mediumDate' }}</h3>
                <button class="close-btn" (click)="closeDayEventsModal()">√ó</button>
            </div>

            <div class="day-events-list">
                <div class="event-item" *ngFor="let event of selectedDayEvents()?.events" (click)="viewEvent(event)">
                    <div class="event-time">{{ event.time }}</div>
                    <div class="event-info">
                        <strong>{{ event.title }}</strong>
                        <span>{{ event.location }}</span>
                    </div>
                    <div class="event-arrow">‚Üí</div>
                </div>
            </div>

            <button class="btn-primary full-width" (click)="openAddEventForm(selectedDayEvents()?.date)">+ Add
                Event</button>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div class="modal-overlay" *ngIf="isFormVisible()" (click)="closeForm()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>Add New Event</h3>
                <button class="close-btn" (click)="closeForm()">√ó</button>
            </div>
            <form [formGroup]="eventForm" (ngSubmit)="onSubmit()">
                <div class="form-group">
                    <label>Event Title</label>
                    <input type="text" formControlName="title" placeholder="Ex: Wedding Ceremony">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" formControlName="date">
                        <div class="error-text"
                            *ngIf="eventForm.get('date')?.invalid && eventForm.get('date')?.touched">
                            Date is required
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" formControlName="time">
                        <div class="error-text"
                            *ngIf="eventForm.get('time')?.invalid && eventForm.get('time')?.touched">
                            Time is required
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" formControlName="location" placeholder="Ex: Grand Hall">
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select formControlName="type">
                            <option value="wedding">Weddings & Receptions</option>
                            <option value="pre-wedding">Pre-Wedding Shoots</option>
                            <option value="housewarming">House Warming</option>
                            <option value="birthday">Birthday Celebrations</option>
                            <option value="shop-opening">Shop / Office Opening</option>
                            <option value="half-saree">Half Saree Function</option>
                            <option value="other">Other Events</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Service Plan</label>
                        <select formControlName="planType">
                            <option *ngFor="let plan of availablePlans()" [value]="plan.key">
                                {{ plan.label }}
                            </option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Completion: {{ completionValue() }}%</label>
                    <input type="range" formControlName="completionPercentage" min="0" max="100" step="5"
                        class="range-slider" (input)="updateSliderValue($event)">
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea formControlName="description" rows="3" placeholder="Additional details..."></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" (click)="closeForm()">Cancel</button>
                    <button type="submit" class="btn-primary">Save Event</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div class="modal-overlay" *ngIf="selectedEvent()" (click)="closeEventDetails()">
        <div class="modal-content details-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>Event Details</h3>
                <button class="close-btn" (click)="closeEventDetails()">√ó</button>
            </div>

            <div class="event-details">
                <h4>{{ selectedEvent()?.title }}</h4>
                <span class="event-type-pill large" [class]="selectedEvent()?.type">{{ selectedEvent()?.type | titlecase
                    }}</span>

                <div class="detail-row">
                    <span class="icon">üìÖ</span>
                    <span>{{ selectedEvent()?.date | date:'fullDate' }}</span>
                </div>
                <div class="detail-row">
                    <span class="icon">‚è∞</span>
                    <span>{{ selectedEvent()?.time }}</span>
                </div>
                <div class="detail-row">
                    <span class="icon">üìç</span>
                    <span>{{ selectedEvent()?.location }}</span>
                </div>

                <div class="progress-section" *ngIf="selectedEvent()?.completionPercentage !== undefined">
                    <div class="progress-label">
                        <span>Completion</span>
                        <span>{{ selectedEvent()?.completionPercentage }}%</span>
                    </div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" [style.width.%]="selectedEvent()?.completionPercentage"></div>
                    </div>
                </div>

                <div class="description" *ngIf="selectedEvent()?.description">
                    <p>{{ selectedEvent()?.description }}</p>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-manage" (click)="navigateToManage(selectedEvent()!.id)">Manage Event</button>
                    <button class="btn-danger" (click)="deleteEvent(selectedEvent()!.id)">Delete Event</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div class="modal-overlay search-overlay" *ngIf="isSearchVisible()" (click)="closeSearch()">
        <div class="modal-content search-modal" (click)="$event.stopPropagation()">
            <div class="search-header">
                <div class="search-input-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" placeholder="Search events by title, location, or type..."
                        [value]="searchQuery()" (input)="onSearchInput($event)" autoFocus>
                </div>
                <button class="close-btn" (click)="closeSearch()">√ó</button>
            </div>

            <div class="search-results">
                <div class="search-results-list" *ngIf="searchQuery()">
                    <div class="upcoming-item" *ngFor="let event of searchResults()" (click)="viewEvent(event)">
                        <div class="date-badge">
                            <span class="day">{{ event.date | date:'dd' }}</span>
                            <span class="month">{{ event.date | date:'MMM' }}</span>
                        </div>
                        <div class="event-details">
                            <h4>{{ event.title }}</h4>
                            <p>{{ event.time }} ‚Ä¢ {{ event.location }}</p>
                            <span class="event-type-pill" [class]="event.type">{{ event.type | titlecase }}</span>
                            <button class="btn btn-manage"
                                style="font-size: 0.8rem; padding: 0.3rem 0.8rem; margin-top: 0.5rem;"
                                (click)="$event.stopPropagation(); navigateToManage(event.id)">Manage Event</button>
                        </div>
                        <div class="arrow">‚Üí</div>
                    </div>
                </div>

                <div class="no-results" *ngIf="searchQuery() && searchResults().length === 0">
                    <p>No events found for "{{ searchQuery() }}"</p>
                </div>

                <div class="initial-state" *ngIf="!searchQuery()">
                    <p>Type to search...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div class="modal-overlay stats-overlay" *ngIf="statModalVisible()" (click)="closeStatModal()">
        <div class="modal-content stats-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>{{ statModalTitle() }}</h3>
                <button class="close-btn" (click)="closeStatModal()">√ó</button>
            </div>

            <div class="stats-list-container">
                <div class="upcoming-item" *ngFor="let event of statModalEvents()" (click)="viewEvent(event)">
                    <div class="date-badge">
                        <span class="day">{{ event.date | date:'dd' }}</span>
                        <span class="month">{{ event.date | date:'MMM' }}</span>
                    </div>
                    <div class="event-details">
                        <h4>{{ event.title }}</h4>
                        <p>{{ event.time }} ‚Ä¢ {{ event.location }}</p>
                        <span class="event-type-pill" [class]="event.type">{{ event.type | titlecase }}</span>
                        <button class="btn btn-manage"
                            style="font-size: 0.8rem; padding: 0.3rem 0.8rem; margin-top: 0.5rem;"
                            (click)="$event.stopPropagation(); navigateToManage(event.id)">Manage Event</button>
                    </div>
                    <div class="arrow">‚Üí</div>
                </div>

                <div class="no-events" *ngIf="statModalEvents().length === 0">
                    <p>No events found for this category.</p>
                </div>
            </div>
        </div>
    </div>
</div>